<!doctype html>

<!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]> <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]> <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Catwalk Test Page</title>

	<style type="text/css" media="screen">
		table th {
	 		text-align: left;
		}
		table th,
		table td {
			padding: 4px;
		}
		table tr:nth-child( 2n + 1 ) {
			background-color: #EEE;
		}
	</style>
	<!-- Bootstrap -->
	<script src="/scripts/libraries/underscore-min.js" type="text/javascript" charset="utf-8"></script>
	<script src="/scripts/libraries/jquery-1.7.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="/scripts/libraries/dust-full-0.3.0.min.js" type="text/javascript" charset="utf-8"></script>

	<!-- Catwalk -->
	<script src="scripts/catwalk-0.0.1.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>

	<div id="container">
		<h1>Catwalk Test Page</h1>
		<div id="data">
		</div>
	</div>
	<script id="results" type="text/template" data-template-id="results" charset="utf-8">
		<table>
		  <tr>
			<th>id</th>
			<th>avatar</th>
			<th><a class="sort" data-property="age" href="#">age</a></th>
			<th>admin</th>
			<th>name</th>
			<th>company</th>
			<th>phone</th>
			<th>email</th>
			<th>registerDate</th>
		  </tr>
		  {#results}
		  <tr>
			<td>{id}</td>
			<td>{avatar}</td>
			<td>{age}</td>
			<td>{admin}</td>
			<td>{name}</td>
			<td>{company}</td>
			<td>{phone}</td>
			<td>{email}</td>
			<td>{registerDate}</td>
		  </tr>
		  {/results}
		</table>
	</script>
	<script type="text/javascript" charset="utf-8">
		$( function() {
			var $templates = $( 'script[type="text/template"]' );

			$templates.each( function( index, item ) {
				var $this = $( item );
				dust.loadSource( dust.compile( $this.html(), $this.data( 'template-id' ) ) );
			} );

		} );
	</script>
	<script type="text/javascript" charset="utf-8">
		$( function () {
			var Activity = new Collection();

			$.getJSON( '/data/data.json', function( data ) {
				_.each( data.result, function( item, index ) {
					Activity.add( new Model( item ) );
				} );
				dust.render( 'results', { results: Activity.data() }, function( error, output ) {
					$( '#data' ).html( output );
				} );

			} );

			$( '#sort' ).live( 'click', function( event ) {
				event.preventDefault();

				var $this = $( this ),
					sort,
					property,
					data,
					ASCENDING = 'ascending',
					DESCENDING = 'descending';

				sort = $this.data( 'sort' );
				property = $this.data( 'property' );
				data = Activity.sort( function( item, index ) {
					return item.age;
				} );

				if( !sort || sort === 'descending' ) {
					sort = 'ascending';
				} else if( sort === 'ascending' ) {
					sort = 'descending';
					data = data.reverse();
				}

				dust.render( 'results', { results: data }, function( error, output ) {
					$( '#data' ).html( output );
				} );

				$this.data( 'sort', sort );
				$this.removeClass( 'ascending descending').addClass( sort );

			} );

		} );		// 
				// console.log( data );
				// _.each( data.result, function( item, index ) {
				// 	Activity.add( new Model( item ) );
				// } );
				// console.info( 'All DATA' );
				// console.log( Activity.data() );
				// console.info( 'AGE = 44' );
				// console.log( Activity.filter( function( item, index ) {
				// 	return ( item.age === 44 );
				// } ) );
				// 
				// console.log( Activity.sort( function( item, index ) {
				// 	return item.age;
				// } ) );
	</script>
</body>

</html>

