<!doctype html>

<!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]> <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]> <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Catwalk Test Page</title>

	<style type="text/css" media="screen">
		table th {
	 		text-align: left;
		}
		table th,
		table td {
			padding: 4px;
		}
		table tr:nth-child( 2n + 1 ) {
			background-color: #EEE;
		}
	</style>
	<!-- Bootstrap -->
	<script src="/scripts/libraries/underscore-min.js" type="text/javascript" charset="utf-8"></script>
	<script src="/scripts/libraries/jquery-1.7.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="/scripts/libraries/dust-full-0.3.0.min.js" type="text/javascript" charset="utf-8"></script>

	<!-- Catwalk -->
	<script src="scripts/catwalk-0.0.1.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>

	<div id="container">
		<h1>Catwalk Test Page</h1>
		<div id="data">
			<table>
				<thead>
				  <tr>
					<th><a class="sort" class="acending" data-sort="ascending" data-property="id" data-type="number" href="#">id</a></th>
					<th><a class="sort" data-property="avatar" href="#" data-type="string">avatar</a></th>
					<th><a class="sort" data-property="age" data-type="number" href="#" data-type="number">age</a></th>
					<th><a class="sort" data-property="admin" href="#" data-type="boolean">admin</a></th>
					<th><a class="sort" data-property="name" href="#" data-type="string">name</a></th>
					<th><a class="sort" data-property="company" href="#" data-type="string">company</a></th>
					<th><a class="sort" data-property="phone" href="#" data-type="number">phone</a></th>
					<th><a class="sort" data-property="email" href="#" data-type="string">email</a></th>
					<th><a class="sort" data-property="registerDate" href="#" data-type="date">registerDate</a></th>
				  </tr>
				<thead>
				<tbody id="results">
				<tbody>
			</table>
		</div>
	</div>
	<script id="results" type="text/template" data-template-id="results" charset="utf-8">
		  {#results}
		  <tr>
			<td>{id}</td>
			<td>{avatar}</td>
			<td>{age}</td>
			<td>{admin}</td>
			<td>{name}</td>
			<td>{company}</td>
			<td>{phone}</td>
			<td>{email}</td>
			<td>{registerDate}</td>
		  </tr>
		  {/results}
	</script>
	<script type="text/javascript" charset="utf-8">
		$( function() {
			var $templates = $( 'script[type="text/template"]' );

			$templates.each( function( index, item ) {
				var $this = $( item );
				dust.loadSource( dust.compile( $this.html(), $this.data( 'template-id' ) ) );
			} );

		} );
	</script>
	<script type="text/javascript" charset="utf-8">
		$( function () {
			var Activity = new Collection();

			function render( data ) {
				dust.render( 'results', { results: data }, function( error, output ) {
					$( '#results' ).html( output );
				} );
			}

			$.getJSON( '/data/data.json', function( data ) {
				_.each( data.result, function( item, index ) {
					Activity.add( new Model( item ) );
				} );
				render( Activity.data() );

			} );

			$( '.sort' ).on( 'click', function( event ) {
				event.preventDefault();

				var $this = $( this ),
					sort,
					property,
					type,
					data,
					ASCENDING = 'ascending',
					DESCENDING = 'descending';

				sort = $this.data( 'sort' );
				type = $this.data( 'type' );
				property = $this.data( 'property' );
				data = Activity.sort( function( item, index ) {
					var value = item[property];
					switch( type ) {
						case 'number':
							return parseFloat( value );
							break;
						case 'string':
							return '' + value + '';
							break;
						case 'boolean':
							if( value ) {
								return true;
							} else {
								return false;
							}
							break;
						case 'date':
							return new Date( value );
							break;
						default:
							return value;
							break;
					}
				} );

				if( !sort || sort === DESCENDING ) {
					sort = ASCENDING;
				} else if( sort === ASCENDING ) {
					sort = DESCENDING;
					data = data.reverse();
				}

				render( data );

				$this.data( 'sort', sort );
				$this.removeClass( ASCENDING + ' ' + DESCENDING ).addClass( sort );

			} );

		} );		// 
				// console.log( data );
				// _.each( data.result, function( item, index ) {
				// 	Activity.add( new Model( item ) );
				// } );
				// console.info( 'All DATA' );
				// console.log( Activity.data() );
				// console.info( 'AGE = 44' );
				// console.log( Activity.filter( function( item, index ) {
				// 	return ( item.age === 44 );
				// } ) );
				// 
				// console.log( Activity.sort( function( item, index ) {
				// 	return item.age;
				// } ) );
	</script>
</body>

</html>

